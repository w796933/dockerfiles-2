#!/bin/bash -eu
INAME=$(echo ${IMAGE} | awk -F/ '{print $(NF)}' | awk -F: '{print $1}')
ENVROOT=${HOST}/etc/sysconfig/containers
ENVFILE=${ENVROOT}/${INAME}/${NAME}

# Destinations for artifacts
: ${HOST_ETC:=${HOST}/etc}
: ${HOST_SYSTEMD:=${HOST_ETC}/systemd/system}
: ${HOST_USR:=${HOST}/usr/local}

# Empty defaults for volumes
: ${CONFDIR:=}
: ${DATADIR:=}
: ${LOGDIR:=}

# Parse variables in a file
function parse_file() {
eval echo "\"$(cat <<EOF
$(<$1)
EOF
)\""
}

# Initialize a volume directory
function mkvol() {
  mkdir -pvm 0750 "$1"
  chmod -c 0750 "$1"
  chown -c "$XUSER": "$1"
}

# List names of installed instances
function find_instances() {
  find $(dirname ${ENVFILE}) -type f -not -name '*~' -printf "%f\n" 2> /dev/null
}
